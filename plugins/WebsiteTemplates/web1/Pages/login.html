<style>
* {
    box-sizing: border-box;
}

body {
    margin: 0;
}

.row {
    display: table;
    padding-top: 10px;
    padding-right: 10px;
    padding-bottom: 10px;
    padding-left: 10px;
    width: 100%;
}

:root {
    margin-top: 0px;
}

:root {
    margin-top: 0px;
}

.row {
    display: table;
    padding-top: 10px;
    padding-right: 10px;
    padding-bottom: 10px;
    padding-left: 10px;
    width: 100%;
}

.gjs-am-file-uploader > form {
    min-height: 325px !important;
}

* {
    box-sizing: border-box;
}

body {
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 0px;
    margin-left: 0px;
}

#c31064 {
    width: 100%;
}

input[type="text"] {
    font-family: sans-serif;
    border-top-width: 1px;
    border-right-width: 1px;
    border-bottom-width: 1px;
    border-left-width: 1px;
    border-top-style: solid;
    border-right-style: solid;
    border-bottom-style: solid;
    border-left-style: solid;
    border-top-color: rgba(0, 0, 0, 0.15);
    border-right-color: rgba(0, 0, 0, 0.15);
    border-bottom-color: rgba(0, 0, 0, 0.15);
    border-left-color: rgba(0, 0, 0, 0.15);
    border-image-source: initial;
    border-image-slice: initial;
    border-image-width: initial;
    border-image-outset: initial;
    border-image-repeat: initial;
}

ul.social-network {
    list-style-type: none;
    list-style-position: initial;
    list-style-image: initial;
    display: inline;
    padding-top: 0px;
    padding-right: 0px;
    padding-bottom: 0px;
    padding-left: 0px;
    margin-left: 0px !important;
}

ul.social-network li {
    display: inline;
    margin-top: 0px;
    margin-right: 5px;
    margin-bottom: 0px;
    margin-left: 5px;
}

.social-network a.icoRss:hover {
    background-color: rgb(41, 41, 41);
}

.social-network a.icoFacebook:hover {
    background-color: rgb(59, 89, 152);
}

.social-network a.icoTwitter:hover {
    background-color: rgb(51, 204, 255);
}

.social-network a.icoGoogle:hover {
    background-color: rgb(189, 53, 24);
}

.social-network a.icoVimeo:hover {
    background-color: rgb(5, 144, 184);
}

.social-network a.icoLinkedin:hover {
    background-color: rgb(0, 123, 183);
}

.social-network a.icoRss:hover i, .social-network a.icoFacebook:hover i, .social-network a.icoTwitter:hover i, .social-network a.icoGoogle:hover i, .social-network a.icoVimeo:hover i, .social-network a.icoLinkedin:hover i {
    color: rgb(255, 255, 255);
}

.socialHoverClass, a.socialIcon:hover {
    color: rgb(68, 188, 221);
}

.social-circle li a {
    display: inline-block;
    position: relative;
    margin-top: 0px;
    margin-right: auto;
    margin-bottom: 0px;
    margin-left: auto;
    border-top-left-radius: 50%;
    border-top-right-radius: 50%;
    border-bottom-right-radius: 50%;
    border-bottom-left-radius: 50%;
    text-align: center;
    width: 50px;
    height: 50px;
    font-size: 20px;
}

.social-circle li i {
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 0px;
    margin-left: 0px;
    line-height: 50px;
    text-align: center;
}

.triggeredHover, .social-circle li a:hover i {
    transform: rotate(360deg);
    transition-duration: 0.2s;
    transition-timing-function: initial;
    transition-delay: initial;
    transition-property: all;
}

.social-circle i {
    color: rgb(0, 0, 0);
    transition-duration: 0.8s;
    transition-timing-function: initial;
    transition-delay: initial;
    transition-property: all;
}

a {
    background-color: rgb(211, 211, 211);
}

a.socialMedCls {
    background-color: rgb(211, 211, 211);
}

.row.mt-4.signup-message {
    text-align: right;
}

.alert-box {
    display: none;
}
.fdb-box.fdb-touch input[type="text"] {
  font-family: sans-serif;
  font-weight: normal;
  font-size: 1rem;
  padding: .5rem .75rem;
}
.login-section {
    width: 50%;
    margin-top: 0px;
    margin-right: auto;
    margin-bottom: 0px;
    margin-left: auto;
}
ul#menu{
    display:block;
}
</style>




<div class="cssImports"></div>
<div id="c18422">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="https://res.cloudinary.com/flowz/raw/upload/v1515673729/builder/css/flowz_blocks.css"
    />
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    rel="stylesheet" />
    <div>
        <div class="login-section">
            <div class="innerpage row">
                <div class="row justify-content-center">
                    <div class="text-center">
                        <div class="fdb-box fdb-touch">
                            <div class="row">
                                <div class="col">
                                    <h1 class="mt-4">Log In</h1>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="alert alert-danger alert-dismissible alert-box"> <strong>Error! </strong><span id="error-message"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col">
                                    <input class="form-control input-fields user_email" type="text" placeholder="Email"
                                    required="true" />
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col">
                                    <input class="form-control input-fields mb-1 user_pass" type="password"
                                    placeholder="Password" required="true" />
                                    <p class="text-right"><a href="signup.html">New User?</a>
                                    </p>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col">
                                    <button class="btn login-submit" type="button">Submit</button>
                                </div>
                            </div>
                            <div class="col-md-12 mt-4">
                                <form id="form-social-icons" name="form-google" method="get">
                                    <ul class="social-network social-circle">
                                        <!-- <li><a class="icoFacebook socialMedCls" href="javascript:;" title="facebook"><i class="fa fa-facebook"></i></a>
                                        </li>-->
                                        <li><a class="icoTwitter socialMedCls" href="javascript:;" title="twitter"><i class="fa fa-twitter"></i></a>
                                        </li>
                                        <li><a class="icoGoogle socialMedCls" href="javascript:;" title="google"><i class="fa fa-google-plus"></i></a>
                                        </li>
                                        <!-- <li><a class="icoLinkedin socialMedCls" href="javascript:;" title="linkedin"><i class="fa fa-linkedin"></i></a>
                                        </li>-->
                                        <li><a class="icoRss socialMedCls" href="javascript:;" title="github"><i class="fa fa-github"></i></a>
                                        </li>
                                    </ul>
                                    <input type="hidden" name="success_url" value="" class="success_url">
                                    <input type="hidden" name="failure_url" value="" class="failure_url">
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.17.1/axios.js"></script>
</div>
<script>
  var items = document.querySelectorAll('#c18422');
  for (var i = 0, len = items.length; i < len; i++) {
    (function() {
        let projectID = "";
        let loginUrl = "";
        let userDetailsUrl = "";
        let socialLoginUrl = "";
        let baseURL = "";
        let BaseUrl = '';
        let adminEmail = '';
        $(document).ready(function() {
            if ($.cookie("user_id") != null && $.cookie("user_auth_token") != null) {
                window.location = "index.html"
            } else {
                $.getJSON("./assets/project-details.json", function(data) {
                    projectID = data[0].projectID;
                    loginUrl = data[0].login_api;
                    userDetailsUrl = data[0].user_details_api;
                    socialLoginUrl = data[0].social_login_api;
                    BaseUrl = data[0].BaseURL;
                    baseURL = data[0].builder_service_api;
                    adminEmail = data[0].projectOwner;
                    $(".success_url").val(data[0].BaseURL);
                    $(".failure_url").val(data[0].BaseURL + 'error404.html')
                })
            }
        });
        $(".input-fields").keyup(function(e) {
            var code = e.which;
            if (code == 13) e.preventDefault();
            if (code == 32 || code == 13 || code == 188 || code == 186) {
                authenticateUser()
            }
        });
        $(".login-submit").click(function() {
            authenticateUser()
        });
        $(".socialMedCls").on("click", function() {
            var action_url = $(this).attr("title");
            $("#form-social-icons").attr("action", socialLoginUrl + action_url);
            $("#form-social-icons").submit()
        });

        function authenticateUser() {
          let loginFlag = true;
            if ($(".user_email").val() != "" && $(".user_pass").val() != "") {
                axios.post(loginUrl, {
                    email: $(".user_email").val(),
                    password: $(".user_pass").val()
                }).then(function(response) {
                    axios.get(userDetailsUrl, {
                        headers: {
                            "Authorization": response.data.logintoken
                        }
                    }).then(async(resp) => {
                        await axios.get(baseURL + "/website-users?websiteId=" + projectID + "&userEmail=" + $(".user_email").val(), {})
                        .then(async(res) => {
                            if (res.data.data.length > 0) {
                                if (res.data.data[0].isActive == true && res.data.data[0].isDeleted == false) {
                                  loginFlag = true;
                                }
                                else {
                                  loginFlag = false;
                                  $(".alert-box").addClass("show");
                                  $("#error-message").text('You are no longer active for this website');
                                  setTimeout(function() {
                                      $(".alert-box").removeClass("show")
                                  }, 5000)
                                }
                            } else {
                                let userRole;
                                let name;
                                if (adminEmail == resp.data.data.email) {
                                  userRole = 'admin';
                                }
                                else {
                                  userRole = 'registered'
                                }
                                if (resp.data.data.fullname && resp.data.data.fullname != '') {
                                  name = resp.data.data.fullname
                                }
                                else {
                                  name = resp.data.data.username
                                }
                                await axios.post(baseURL + "/website-users", {
                                    userEmail: resp.data.data.email,
                                    userRole: userRole,
                                    websiteId: projectID,
                                    isActive: true,
                                    isDeleted: false,
                                    userName: name
                                }).then((respo) => {
                                    loginFlag = true
                                }).catch((e) => {
                                    loginFlag = false;
                                })
                            }
                        }).catch((e) => {
                            console.log(e)
                        });
                        if (loginFlag) {
                          $.cookie("user_auth_token", response.data.logintoken, {
                              path: window.location.hostname
                          });
                          $.cookie("user_id", resp.data.data._id, {
                              path: window.location.hostname
                          });
                          if (document.referrer.trim() != "") {
                              if (document.referrer.indexOf(BaseUrl) >= 0) {
                                  window.location = document.referrer
                              } else {
                                  window.location = "index.html"
                              }
                          } else {
                              window.location = "index.html"
                          }
                        }
                    }).catch((e) => {
                        console.log(e)
                    })
                }).catch(function(error) {
                    $(".alert-box").addClass("show");
                    $("#error-message").text(error.response.data);
                    setTimeout(function() {
                        $(".alert-box").removeClass("show")
                    }, 5000)
                })
            } else if ($(".user_email").val() == "" && $(".user_pass").val() != "") {
                $(".alert-box").addClass("show");
                $("#error-message").text("Please enter your email");
                setTimeout(function() {
                    $(".alert-box").removeClass("show")
                }, 5000)
            } else if ($(".user_email").val() != "" && $(".user_pass").val() == "") {
                $(".alert-box").addClass("show");
                $("#error-message").text("Please enter password");
                setTimeout(function() {
                    $(".alert-box").removeClass("show")
                }, 5000)
            } else {
                $(".alert-box").addClass("show");
                $("#error-message").text("Please enter login credentials");
                setTimeout(function() {
                    $(".alert-box").removeClass("show")
                }, 5000)
            }
        }
    }.bind(items[i]))()
  }
</script>
